<div class="score-sheet">
  <h1>Yathzee</h1>

  <div class="button-group">
    <button
      [ngClass]="{'active': desVirtuel}"
      (click)="toggleButtonsDes()">
      Faire des lancés de dés
    </button>
    <button
      [ngClass]="{'active': !desVirtuel}"
      (click)="toggleButtonsDes()">
      Sélectionner les valeurs des dés
    </button>
  </div>

  @if (desVirtuel) {
    <div class="roll-dice-container">
      <app-dices [maxRolls]="3" [numberOfDice]="5" (diceRolled)="changeDiceValue($event)"></app-dices>
    </div>
  }

  @if (!desVirtuel) {
    <div class="dice-container">
      @for (die of dice; track die; let index = $index) {
        <div class="die-row">
          <span>Dé {{ index + 1 }} :</span>
          <div class="die-buttons">
            @for (value of [1, 2, 3, 4, 5, 6]; track value) {
              <button [class.active]="die === value"
                (click)="setDieValue(index, value)">
                <img [src]="'assets/rsc/' + getDieImage(value)" [alt]="value" />
              </button>
            }
          </div>
        </div>
      }
    </div>
  }



  <div class="player-selector">
    <button (click)="changePlayer('left')"><i class="fa-solid fa-arrow-left"></i></button>
    @if (players !== undefined && players.length > 0) {
      <span>{{ players[activePlayerIndex].name }}</span>
    }
    <button (click)="changePlayer('right')"><i class="fa-solid fa-arrow-right"></i></button>
  </div>

  <!-- Tableau des scores -->
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Catégories</th>
          @for (player of players; track player) {
            <th>{{ player.name }}</th>
          }
        </tr>
      </thead>
      <tbody>
        <!-- Catégories -->
        @for (category of categories; track category) {
          <tr>
            <td>{{ category }}</td>
            @for (player of players; track player) {
              <td [ngClass]="{ 'locked-cell': locked[player.id][category] }">
                <div class="score-cell" [ngClass]="{ 'locked-cell': locked[player.id][category] }">
                  <!-- Si la case est verrouillée -->
                  @if (locked[player.id][category]) {
                    <span>
                      {{ scores[player.id][category] ?? '-' }}
                      @if (isActivePlayer(player.id)) {
                        <button (click)="unlockScore(category)" class="edit-button"><i
                        class="fa-solid fa-pen-to-square"></i>
                      </button>
                    }
                  </span>
                }
                <!-- Si la case est modifiable par le joueur actif -->
                @if (isActivePlayer(player.id) && !locked[player.id][category]) {
                  <div>
                    <span>{{ scores[player.id][category] ?? calculatePoints(category) }}</span>
                    <button (click)="lockScore(category)" class="ok-button"><i class="fa-solid fa-check"></i></button>
                  </div>
                }
              </div>
            </td>
          }
        </tr>
      }

      <!-- Ligne bonus -->
      <tr class="bonus-row">
        <td><strong>Bonus</strong></td>
        @for (player of players; track player) {
          <td>
            <strong>{{ getBonus(player.id) }}</strong>
          </td>
        }
      </tr>

      <!-- Total -->
      <tr>
        <td><strong>Total</strong></td>
        @for (player of players; track player) {
          <td>
            <strong>{{ getTotal(player.id) }}</strong>
          </td>
        }
      </tr>
    </tbody>
  </table>
</div>

@if (gameOver) {
  <div class="game-over-message" style="margin-top : 30px;">
    <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#winnerModal">Finir la
    partie</button>
  </div>
}
</div>

<div class="modal fade" id="winnerModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <app-winner (outWindow)="closeGame()"></app-winner>
    </div>
  </div>
</div>
